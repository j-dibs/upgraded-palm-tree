<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Reference Manager</title>
  <style>
    :root{
      --navy:#0b1e3f;
      --navy-700:#0f2a5c;
      --navy-600:#173a7a;
      --orange:#ff7a1a;
      --bg:#f7f8fb;
      --card:#ffffff;
      --text:#101113;
      --muted:#5a6472;
      --focus:#ffd36a;
      --border:#e2e8f0;
      --success:#1f9d55;
      --danger:#b42318;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:var(--bg);
      line-height:1.4;
    }
    a{color:var(--orange)}
    .container{max-width:1200px; margin-inline:auto; padding:24px}
    header{
      background:linear-gradient(0deg,var(--navy-700),var(--navy));
      color:white; padding:28px 20px; position:sticky; top:0; z-index:5; border-bottom:4px solid var(--orange);
    }
    header .brand{display:flex; align-items:center; gap:12px}
    .brand .mark{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,var(--orange),#ffd36a); display:inline-block}
    .brand h1{font-size:20px; margin:0}

    nav{margin-top:16px; display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      appearance:none; border:none; cursor:pointer; border-radius:12px; padding:10px 14px; font-weight:600;
      transition:transform .04s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:var(--orange); color:#0b0b0b}
    .btn.secondary{background:#fff; color:var(--navy-700); border:1px solid var(--border)}
    .btn.ghost{background:transparent; color:#fff; border:1px solid rgba(255,255,255,.2)}
    .btn.danger{background:var(--danger); color:#fff}
    .btn.success{background:var(--success); color:#fff}
    .btn:focus-visible{outline:3px solid var(--focus); outline-offset:2px}

    .grid{display:grid; gap:16px}
    .two{grid-template-columns:300px 1fr}

    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .card h2{margin:0 0 8px 0; font-size:18px}

    .muted{color:var(--muted)}
    label{font-weight:600; display:block; margin:.6rem 0 .3rem}
    input[type="text"], input[type="number"], input[type="url"], input[type="date"], textarea, select{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#fff; color:var(--text);
    }

    .list{display:grid; gap:12px}
    .list .item{padding:12px; border:1px solid var(--border); border-radius:12px; background:#fff; display:flex; justify-content:space-between; align-items:center; gap:10px}
    .list .item .meta{font-size:12px; color:var(--muted)}

    .sidebar{position:sticky; top:112px; align-self:start}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="brand">
        <span class="mark"></span>
        <h1>Personal Reference Manager</h1>
      </div>
      <nav>
        <button class="btn ghost" data-nav="home">Home</button>
        <button class="btn ghost" data-nav="add">Add Reference</button>
        <button class="btn ghost" data-nav="library">Search & Library</button>
      </nav>
    </div>
  </header>

  <main class="container" id="app"></main>

  <script>
  const STORE_KEY = 'prm.references.v1';
  const STYLE_KEY = 'prm.style.v1';

  const TYPES = [
    {id:'journal',name:'Journal article'},
    {id:'book',name:'Book'},
    {id:'chapter',name:'Book chapter'},
    {id:'website',name:'Web page'},
    {id:'report',name:'Report'},
    {id:'thesis',name:'Thesis / Dissertation'},
    {id:'conference',name:'Conference paper'},
    {id:'newspaper',name:'Newspaper article'}
  ];

  const STYLES = ['Harvard','APA','MLA','Chicago'];

  const loadAll=()=>JSON.parse(localStorage.getItem(STORE_KEY)||'[]');
  const saveAll=(a)=>localStorage.setItem(STORE_KEY,JSON.stringify(a));
  const loadStyle=()=>localStorage.getItem(STYLE_KEY)||'Harvard';
  const saveStyle=(s)=>localStorage.setItem(STYLE_KEY,s);

  function formatAuthors(ref){
    if(!ref.authors||!ref.authors.length) return '';
    return ref.authors.map(a=>\`\${a.first} \${a.last}\`).join(', ');
  }

  function formatRef(ref,style){
    const A=formatAuthors(ref);
    const Y=ref.year||'n.d.';
    const T=ref.title||'';
    switch(style){
      case 'APA': return \`\${A} (\${Y}). \${T}. \${ref.journal||ref.publisher||''}.\`;
      case 'MLA': return \`\${A}. "\${T}." \${ref.journal||ref.publisher||''}, \${Y}.\`;
      case 'Chicago': return \`\${A}. \${Y}. "\${T}." \${ref.journal||ref.publisher||''}.\`;
      default: return \`\${A} (\${Y}) \${T}. \${ref.journal||ref.publisher||''}.\`; // Harvard
    }
  }

  function renderLibrary(){
    const refs=loadAll();
    const style=loadStyle();
    const app=document.getElementById('app');
    app.innerHTML=\`
    <section class="grid two">
      <aside class="sidebar card">
        <h2>Filters</h2>
        <label>Author</label>
        <input type="text" id="fAuthor" placeholder="Search author" />
        <label>Tag</label>
        <input type="text" id="fTag" placeholder="Search tag" />
        <label>Journal / Publisher</label>
        <input type="text" id="fJournal" placeholder="Search journal" />
        <label>Year range</label>
        <div style="display:flex; gap:8px">
          <input type="number" id="yFrom" placeholder="From" />
          <input type="number" id="yTo" placeholder="To" />
        </div>
        <label>Reference Style</label>
        <select id="refStyle">\${STYLES.map(s=>\`<option \${s===style?'selected':''}>\${s}</option>\`).join('')}</select>
        <button class="btn" id="clearFilters" style="margin-top:10px">Clear filters</button>
      </aside>
      <section>
        <div class="card">
          <h2>Search</h2>
          <input type="text" id="search" placeholder="Search title or notes" />
        </div>
        <div class="card">
          <h2>All references</h2>
          <div id="list" class="list"></div>
          <div class="muted" id="empty" style="display:none">No references found.</div>
        </div>
      </section>
    </section>\`;

    const fAuthor=document.getElementById('fAuthor');
    const fTag=document.getElementById('fTag');
    const fJournal=document.getElementById('fJournal');
    const yFrom=document.getElementById('yFrom');
    const yTo=document.getElementById('yTo');
    const search=document.getElementById('search');
    const styleSel=document.getElementById('refStyle');
    const list=document.getElementById('list');
    const empty=document.getElementById('empty');

    styleSel.addEventListener('change',()=>{saveStyle(styleSel.value); renderLibrary();});
    document.getElementById('clearFilters').addEventListener('click',()=>{
      [fAuthor,fTag,fJournal,yFrom,yTo,search].forEach(i=>i.value='');
      renderList();
    });
    [fAuthor,fTag,fJournal,yFrom,yTo,search].forEach(el=>el.addEventListener('input',renderList));

    function applyFilters(r){
      const a=fAuthor.value.toLowerCase();
      const t=fTag.value.toLowerCase();
      const j=fJournal.value.toLowerCase();
      const yF=Number(yFrom.value)||-Infinity;
      const yT=Number(yTo.value)||Infinity;
      const q=search.value.toLowerCase();
      return (!a||formatAuthors(r).toLowerCase().includes(a))
        &&(!t||(r.tags||[]).some(x=>x.toLowerCase().includes(t)))
        &&(!j&&!(r.journal||r.publisher)?true:(r.journal||r.publisher||'').toLowerCase().includes(j))
        &&(!r.year||(+r.year>=yF&&+r.year<=yT))
        &&(!q||((r.title||'').toLowerCase().includes(q)||(r.review||'').toLowerCase().includes(q)));
    }

    function renderList(){
      list.innerHTML='';
      const styleNow=loadStyle();
      const items=refs.filter(applyFilters);
      if(!items.length){empty.style.display='block';return;}
      empty.style.display='none';
      items.forEach(r=>{
        const div=document.createElement('div');
        div.className='item';
        div.innerHTML=\`<div><strong>\${formatAuthors(r)}</strong> â€” \${r.title||''}<div class="meta">\${formatRef(r,styleNow)}</div></div>\`;
        list.appendChild(div);
      });
    }
    renderList();
  }

  function renderHome(){
    document.getElementById('app').innerHTML='<div class="card"><h2>Welcome</h2><p>Go to the Library to view and manage your references.</p></div>';
  }

  function navigate(){
    const hash=location.hash.replace('#','')||'home';
    if(hash==='library')renderLibrary();else renderHome();
  }
  window.addEventListener('hashchange',navigate);
  document.addEventListener('DOMContentLoaded',navigate);
  </script>
</body>
</html>
